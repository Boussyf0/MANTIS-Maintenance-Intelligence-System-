# ════════════════════════════════════════════════════════════════════════
# MANTIS - Environnement STAGING
# ════════════════════════════════════════════════════════════════════════
#
# Environnement miroir de la production pour tests pré-déploiement
#
# ════════════════════════════════════════════════════════════════════════

ENVIRONMENT=staging
PROJECT_NAME=mantis-staging
PROJECT_VERSION=1.0.0-rc
LOG_LEVEL=INFO

# ────────────────────────────────────────────────────────────────────────
# KAFKA
# ──────────────────────────────────────────────────────────────────────────
KAFKA_BOOTSTRAP_SERVERS=kafka-staging:9092
KAFKA_GROUP_ID=mantis-staging-consumer
KAFKA_AUTO_OFFSET_RESET=earliest

KAFKA_TOPIC_SENSOR_RAW=sensor.raw
KAFKA_TOPIC_SENSOR_PREPROCESSED=sensor.preprocessed
KAFKA_TOPIC_FEATURES_COMPUTED=features.computed
KAFKA_TOPIC_ANOMALIES_DETECTED=anomalies.detected
KAFKA_TOPIC_RUL_PREDICTIONS=rul.predictions
KAFKA_TOPIC_MAINTENANCE_ACTIONS=maintenance.actions

# ────────────────────────────────────────────────────────────────────────
# DATABASES
# ────────────────────────────────────────────────────────────────────────
POSTGRES_HOST=postgres-staging.internal
POSTGRES_PORT=5432
POSTGRES_DB=mantis_staging
POSTGRES_USER=mantis_staging
POSTGRES_PASSWORD=<CHANGE_ME_STRONG_PASSWORD>
POSTGRES_MAX_CONNECTIONS=100
POSTGRES_SSL_MODE=require

TIMESCALEDB_HOST=timescaledb-staging.internal
TIMESCALEDB_PORT=5432
TIMESCALEDB_DB=mantis_timeseries_staging
TIMESCALEDB_USER=mantis_staging
TIMESCALEDB_PASSWORD=<CHANGE_ME_STRONG_PASSWORD>
TIMESCALEDB_SSL_MODE=require

INFLUXDB_URL=https://influxdb-staging.internal:8086
INFLUXDB_ORG=mantis-staging
INFLUXDB_BUCKET=sensor_data_staging
INFLUXDB_TOKEN=<CHANGE_ME_TOKEN>
INFLUXDB_ADMIN_USER=admin
INFLUXDB_ADMIN_PASSWORD=<CHANGE_ME_STRONG_PASSWORD>
INFLUXDB_TLS_VERIFY=true

REDIS_HOST=redis-staging.internal
REDIS_PORT=6379
REDIS_PASSWORD=<CHANGE_ME_STRONG_PASSWORD>
REDIS_DB=0
REDIS_SSL=true

# ────────────────────────────────────────────────────────────────────────
# OBJECT STORAGE
# ────────────────────────────────────────────────────────────────────────
MINIO_ENDPOINT=s3-staging.internal:9000
MINIO_ACCESS_KEY=<CHANGE_ME_ACCESS_KEY>
MINIO_SECRET_KEY=<CHANGE_ME_SECRET_KEY>
MINIO_SECURE=true
MINIO_BUCKET_RAW_DATA=mantis-raw-staging
MINIO_BUCKET_PROCESSED=mantis-processed-staging
MINIO_BUCKET_MODELS=mantis-models-staging
MINIO_BUCKET_MLFLOW=mantis-mlflow-staging

# ────────────────────────────────────────────────────────────────────────
# MLOPS
# ────────────────────────────────────────────────────────────────────────
MLFLOW_TRACKING_URI=https://mlflow-staging.internal:5002
MLFLOW_BACKEND_STORE_URI=postgresql://mantis_staging:<PASSWORD>@postgres-staging.internal:5432/mlflow_staging
MLFLOW_ARTIFACT_ROOT=s3://mantis-mlflow-staging
MLFLOW_S3_ENDPOINT_URL=https://s3-staging.internal:9000

FEAST_ONLINE_STORE=redis
FEAST_OFFLINE_STORE=s3
FEAST_REGISTRY_PATH=s3://mantis-feast-staging/registry.db

# ────────────────────────────────────────────────────────────────────────
# SERVICES PORTS
# ────────────────────────────────────────────────────────────────────────
PORT_INGESTION_IIOT=8001
PORT_PREPROCESSING=8002
PORT_FEATURE_EXTRACTION=8003
PORT_ANOMALY_DETECTION=8004
PORT_RUL_PREDICTION=8005
PORT_ORCHESTRATOR=8006
PORT_DASHBOARD=3000

# ────────────────────────────────────────────────────────────────────────
# ML CONFIGURATION
# ────────────────────────────────────────────────────────────────────────
MODEL_RUL_PATH=s3://mantis-models-staging/rul/latest
MODEL_ANOMALY_PATH=s3://mantis-models-staging/anomaly/latest

RUL_WINDOW_SIZE=512
RUL_OVERLAP=0.5
ANOMALY_THRESHOLD=0.8
FEATURE_EXTRACTION_SAMPLING_RATE=1000

# ────────────────────────────────────────────────────────────────────────
# MONITORING
# ────────────────────────────────────────────────────────────────────────
PROMETHEUS_URL=https://prometheus-staging.internal:9091
GRAFANA_URL=https://grafana-staging.internal:3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=<CHANGE_ME_STRONG_PASSWORD>

JAEGER_AGENT_HOST=jaeger-staging.internal
JAEGER_AGENT_PORT=6831
JAEGER_COLLECTOR_ENDPOINT=https://jaeger-staging.internal:14268/api/traces
JAEGER_SAMPLER_PARAM=0.5  # 50% sampling en staging

# ────────────────────────────────────────────────────────────────────────
# SÉCURITÉ
# ────────────────────────────────────────────────────────────────────────
JWT_SECRET_KEY=<CHANGE_ME_GENERATE_WITH_OPENSSL>
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=12

# ────────────────────────────────────────────────────────────────────────
# PERFORMANCE
# ────────────────────────────────────────────────────────────────────────
JAVA_OPTS=-Xms1g -Xmx4g
SPRING_PROFILES_ACTIVE=staging
PYTHONUNBUFFERED=1
MAX_WORKERS=8

KAFKA_CONSUMER_BATCH_SIZE=200
PREPROCESSING_BATCH_SIZE=512
FEATURE_EXTRACTION_BATCH_SIZE=256

# ────────────────────────────────────────────────────────────────────────
# RETENTION
# ────────────────────────────────────────────────────────────────────────
RETENTION_RAW_DATA_DAYS=30
RETENTION_PREPROCESSED_DAYS=60
RETENTION_FEATURES_DAYS=90
RETENTION_PREDICTIONS_DAYS=90
COMPRESSION_AFTER_DAYS=3

# ────────────────────────────────────────────────────────────────────────
# DEBUG (Plus permissif qu'en prod)
# ────────────────────────────────────────────────────────────────────────
DEBUG=false
ENABLE_PROFILING=true
ENABLE_MOCK_DATA=false
ENABLE_SWAGGER_UI=true  # OK en staging
