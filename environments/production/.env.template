# ════════════════════════════════════════════════════════════════════════
# MANTIS - Environnement PRODUCTION
# ════════════════════════════════════════════════════════════════════════
#
# ⚠️  IMPORTANT - SÉCURITÉ ⚠️
# - NE JAMAIS commiter ce fichier avec des vraies valeurs
# - Utiliser un gestionnaire de secrets (HashiCorp Vault, AWS Secrets Manager)
# - Tous les mots de passe doivent être forts et uniques
# - Activer TLS/SSL sur tous les services
# - Restreindre les accès réseau avec des firewalls
#
# ════════════════════════════════════════════════════════════════════════

ENVIRONMENT=production
PROJECT_NAME=mantis-prod
PROJECT_VERSION=1.0.0
LOG_LEVEL=WARNING  # WARNING ou ERROR en production

# ────────────────────────────────────────────────────────────────────────
# KAFKA
# ────────────────────────────────────────────────────────────────────────
KAFKA_BOOTSTRAP_SERVERS=kafka-1.prod:9092,kafka-2.prod:9092,kafka-3.prod:9092
KAFKA_GROUP_ID=mantis-prod-consumer
KAFKA_AUTO_OFFSET_RESET=earliest

# Security
KAFKA_SECURITY_PROTOCOL=SASL_SSL
KAFKA_SASL_MECHANISM=SCRAM-SHA-512
KAFKA_SASL_USERNAME=<VAULT_SECRET>
KAFKA_SASL_PASSWORD=<VAULT_SECRET>
KAFKA_SSL_CA_LOCATION=/etc/ssl/kafka-ca.pem
KAFKA_SSL_CERT_LOCATION=/etc/ssl/kafka-cert.pem
KAFKA_SSL_KEY_LOCATION=/etc/ssl/kafka-key.pem

# Topics
KAFKA_TOPIC_SENSOR_RAW=sensor.raw
KAFKA_TOPIC_SENSOR_PREPROCESSED=sensor.preprocessed
KAFKA_TOPIC_FEATURES_COMPUTED=features.computed
KAFKA_TOPIC_ANOMALIES_DETECTED=anomalies.detected
KAFKA_TOPIC_RUL_PREDICTIONS=rul.predictions
KAFKA_TOPIC_MAINTENANCE_ACTIONS=maintenance.actions

# ────────────────────────────────────────────────────────────────────────
# POSTGRESQL (Métadonnées) - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
POSTGRES_HOST=postgres-primary.prod.internal
POSTGRES_PORT=5432
POSTGRES_DB=mantis_prod
POSTGRES_USER=mantis_prod
POSTGRES_PASSWORD=<VAULT_SECRET>  # ⚠️ Utiliser Vault!
POSTGRES_MAX_CONNECTIONS=200
POSTGRES_SSL_MODE=require
POSTGRES_SSL_ROOT_CERT=/etc/ssl/postgres-ca.pem

# Read replicas pour scaling
POSTGRES_READ_REPLICA_HOSTS=postgres-replica-1.prod.internal,postgres-replica-2.prod.internal

# ────────────────────────────────────────────────────────────────────────
# TIMESCALEDB (Séries temporelles) - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
TIMESCALEDB_HOST=timescaledb.prod.internal
TIMESCALEDB_PORT=5432
TIMESCALEDB_DB=mantis_timeseries_prod
TIMESCALEDB_USER=mantis_ts_prod
TIMESCALEDB_PASSWORD=<VAULT_SECRET>  # ⚠️ Utiliser Vault!
TIMESCALEDB_SSL_MODE=require

# ────────────────────────────────────────────────────────────────────────
# INFLUXDB (Haute fréquence) - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
INFLUXDB_URL=https://influxdb.prod.internal:8086
INFLUXDB_ORG=mantis-production
INFLUXDB_BUCKET=sensor_data_prod
INFLUXDB_TOKEN=<VAULT_SECRET>  # ⚠️ Utiliser Vault!
INFLUXDB_ADMIN_USER=admin
INFLUXDB_ADMIN_PASSWORD=<VAULT_SECRET>  # ⚠️ Utiliser Vault!
INFLUXDB_TLS_VERIFY=true

# ────────────────────────────────────────────────────────────────────────
# REDIS (Cache) - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
REDIS_HOST=redis-cluster.prod.internal
REDIS_PORT=6379
REDIS_PASSWORD=<VAULT_SECRET>  # ⚠️ Utiliser Vault!
REDIS_DB=0
REDIS_SSL=true
REDIS_SSL_CA_CERTS=/etc/ssl/redis-ca.pem

# Redis Sentinel pour HA
REDIS_SENTINEL_HOSTS=sentinel-1.prod:26379,sentinel-2.prod:26379,sentinel-3.prod:26379
REDIS_SENTINEL_MASTER_NAME=mantis-master

# ────────────────────────────────────────────────────────────────────────
# MINIO / S3 (Object Storage) - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# Option 1: MinIO
MINIO_ENDPOINT=s3.prod.internal:9000
MINIO_ACCESS_KEY=<VAULT_SECRET>  # ⚠️ Utiliser Vault!
MINIO_SECRET_KEY=<VAULT_SECRET>  # ⚠️ Utiliser Vault!
MINIO_SECURE=true  # TLS obligatoire

# Option 2: AWS S3
# S3_BUCKET_NAME=mantis-production
# AWS_ACCESS_KEY_ID=<VAULT_SECRET>
# AWS_SECRET_ACCESS_KEY=<VAULT_SECRET>
# AWS_REGION=eu-west-1

MINIO_BUCKET_RAW_DATA=mantis-raw-data-prod
MINIO_BUCKET_PROCESSED=mantis-processed-prod
MINIO_BUCKET_MODELS=mantis-models-prod
MINIO_BUCKET_MLFLOW=mantis-mlflow-prod

# ────────────────────────────────────────────────────────────────────────
# MLFLOW - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
MLFLOW_TRACKING_URI=https://mlflow.prod.internal:5000
MLFLOW_BACKEND_STORE_URI=postgresql://mlflow_user:<VAULT_SECRET>@postgres-primary.prod.internal:5432/mlflow_prod
MLFLOW_ARTIFACT_ROOT=s3://mantis-mlflow-prod
MLFLOW_S3_ENDPOINT_URL=https://s3.prod.internal:9000

# ────────────────────────────────────────────────────────────────────────
# FEAST (Feature Store) - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
FEAST_ONLINE_STORE=redis
FEAST_OFFLINE_STORE=s3
FEAST_REGISTRY_PATH=s3://mantis-feast-prod/registry.db

# ────────────────────────────────────────────────────────────────────────
# SERVICES PORTS (Internal)
# ────────────────────────────────────────────────────────────────────────
PORT_INGESTION_IIOT=8001
PORT_PREPROCESSING=8002
PORT_FEATURE_EXTRACTION=8003
PORT_ANOMALY_DETECTION=8004
PORT_RUL_PREDICTION=8005
PORT_ORCHESTRATOR=8006
PORT_DASHBOARD=3000

# ────────────────────────────────────────────────────────────────────────
# PROTOCOLES INDUSTRIELS - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# OPC UA
OPCUA_ENDPOINT=opc.tcp://plc-gateway.factory.internal:4840
OPCUA_SECURITY_POLICY=Basic256Sha256  # Sécurité maximale
OPCUA_USERNAME=<VAULT_SECRET>
OPCUA_PASSWORD=<VAULT_SECRET>
OPCUA_CERTIFICATE_PATH=/etc/ssl/opcua-cert.pem
OPCUA_PRIVATE_KEY_PATH=/etc/ssl/opcua-key.pem

# MQTT
MQTT_BROKER=mqtt.factory.internal
MQTT_PORT=8883  # TLS
MQTT_USERNAME=<VAULT_SECRET>
MQTT_PASSWORD=<VAULT_SECRET>
MQTT_CLIENT_ID=mantis-prod-mqtt
MQTT_TLS_CA_CERTS=/etc/ssl/mqtt-ca.pem
MQTT_TLS_CERT=/etc/ssl/mqtt-cert.pem
MQTT_TLS_KEY=/etc/ssl/mqtt-key.pem

# Modbus TCP
MODBUS_HOST=modbus-gateway.factory.internal
MODBUS_PORT=502
MODBUS_UNIT_ID=1

# ────────────────────────────────────────────────────────────────────────
# ML CONFIGURATION - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
MODEL_RUL_PATH=s3://mantis-models-prod/rul/v2.1.0
MODEL_ANOMALY_PATH=s3://mantis-models-prod/anomaly/v1.5.0

RUL_WINDOW_SIZE=512
RUL_OVERLAP=0.5
ANOMALY_THRESHOLD=0.85  # Plus strict en production
FEATURE_EXTRACTION_SAMPLING_RATE=1000

# ────────────────────────────────────────────────────────────────────────
# MONITORING & OBSERVABILITY - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
PROMETHEUS_URL=https://prometheus.monitoring.internal:9090
GRAFANA_URL=https://grafana.monitoring.internal:3000
GRAFANA_ADMIN_USER=<VAULT_SECRET>
GRAFANA_ADMIN_PASSWORD=<VAULT_SECRET>

JAEGER_AGENT_HOST=jaeger-agent.monitoring.internal
JAEGER_AGENT_PORT=6831
JAEGER_COLLECTOR_ENDPOINT=https://jaeger.monitoring.internal:14268/api/traces
JAEGER_SAMPLER_TYPE=probabilistic
JAEGER_SAMPLER_PARAM=0.1  # 10% sampling en prod

# ────────────────────────────────────────────────────────────────────────
# ALERTING - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# PagerDuty
PAGERDUTY_API_KEY=<VAULT_SECRET>
PAGERDUTY_SERVICE_KEY=<VAULT_SECRET>

# Slack
SLACK_WEBHOOK_URL=<VAULT_SECRET>
SLACK_CHANNEL=#mantis-prod-alerts

# Email
SMTP_HOST=smtp.company.com
SMTP_PORT=587
SMTP_USERNAME=<VAULT_SECRET>
SMTP_PASSWORD=<VAULT_SECRET>
SMTP_FROM_EMAIL=mantis-prod@company.com
SMTP_TLS=true

# ────────────────────────────────────────────────────────────────────────
# SÉCURITÉ - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# JWT
JWT_SECRET_KEY=<VAULT_SECRET>  # ⚠️ Générer avec: openssl rand -hex 32
JWT_ALGORITHM=RS256  # Asymétrique en production
JWT_PUBLIC_KEY_PATH=/etc/ssl/jwt-public.pem
JWT_PRIVATE_KEY_PATH=/etc/ssl/jwt-private.pem
JWT_EXPIRATION_HOURS=8  # Plus court en prod

# OAuth2/OIDC (Keycloak)
OAUTH2_ISSUER=https://auth.company.com/realms/mantis
OAUTH2_CLIENT_ID=mantis-production
OAUTH2_CLIENT_SECRET=<VAULT_SECRET>

# API Keys
API_KEY_HEADER=X-API-Key
API_RATE_LIMIT=1000/hour

# ────────────────────────────────────────────────────────────────────────
# PERFORMANCE & SCALING - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# Java Services
JAVA_OPTS=-Xms2g -Xmx8g -XX:+UseG1GC -XX:MaxGCPauseMillis=200
SPRING_PROFILES_ACTIVE=production

# Python Services
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1
MAX_WORKERS=16  # Selon CPU disponibles
WORKER_CLASS=uvicorn.workers.UvicornWorker
WORKER_TIMEOUT=120

# Connection Pooling
DB_POOL_MIN_SIZE=10
DB_POOL_MAX_SIZE=50
REDIS_POOL_MAX_CONNECTIONS=100

# ────────────────────────────────────────────────────────────────────────
# DATA PROCESSING - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
KAFKA_CONSUMER_BATCH_SIZE=500
PREPROCESSING_BATCH_SIZE=1024
FEATURE_EXTRACTION_BATCH_SIZE=512

KAFKA_CONSUMER_TIMEOUT=60
HTTP_TIMEOUT=120
DB_CONNECTION_TIMEOUT=30

# Circuit Breaker
CIRCUIT_BREAKER_FAILURE_THRESHOLD=5
CIRCUIT_BREAKER_RECOVERY_TIMEOUT=60
CIRCUIT_BREAKER_HALF_OPEN_MAX_CALLS=3

# Retry Policy
MAX_RETRY_ATTEMPTS=3
RETRY_BACKOFF_SECONDS=2

# ────────────────────────────────────────────────────────────────────────
# RETENTION & CLEANUP - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
RETENTION_RAW_DATA_DAYS=90
RETENTION_PREPROCESSED_DAYS=180
RETENTION_FEATURES_DAYS=730  # 2 ans
RETENTION_PREDICTIONS_DAYS=1095  # 3 ans

COMPRESSION_AFTER_DAYS=7
BACKUP_RETENTION_DAYS=365

# Cleanup Schedule (cron)
CLEANUP_SCHEDULE="0 2 * * *"  # 2h du matin tous les jours

# ────────────────────────────────────────────────────────────────────────
# HIGH AVAILABILITY - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# Kubernetes
K8S_NAMESPACE=mantis-production
K8S_REPLICA_COUNT_MIN=3
K8S_REPLICA_COUNT_MAX=10

# Auto-scaling
AUTOSCALE_CPU_THRESHOLD=70
AUTOSCALE_MEMORY_THRESHOLD=80
AUTOSCALE_KAFKA_LAG_THRESHOLD=10000

# Health Checks
HEALTH_CHECK_INTERVAL_SECONDS=10
HEALTH_CHECK_TIMEOUT_SECONDS=5
HEALTH_CHECK_RETRIES=3

# ────────────────────────────────────────────────────────────────────────
# BACKUP & DISASTER RECOVERY - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# Backup
BACKUP_ENABLED=true
BACKUP_SCHEDULE="0 1 * * *"  # 1h du matin
BACKUP_RETENTION_DAYS=30
BACKUP_S3_BUCKET=mantis-backups-prod
BACKUP_ENCRYPTION_KEY=<VAULT_SECRET>

# DR
DR_REGION=eu-west-2  # Région secondaire
DR_REPLICATION_ENABLED=true
DR_RTO_MINUTES=60  # Recovery Time Objective
DR_RPO_MINUTES=5   # Recovery Point Objective

# ────────────────────────────────────────────────────────────────────────
# COMPLIANCE & AUDIT - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# Audit Logging
AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=2555  # 7 ans pour conformité
AUDIT_LOG_S3_BUCKET=mantis-audit-logs-prod

# Encryption at Rest
ENCRYPTION_AT_REST_ENABLED=true
ENCRYPTION_KEY_ID=<KMS_KEY_ID>

# Compliance
GDPR_ENABLED=true
DATA_RESIDENCY=EU
PII_ENCRYPTION_ENABLED=true

# ────────────────────────────────────────────────────────────────────────
# EXTERNAL INTEGRATIONS - PRODUCTION
# ────────────────────────────────────────────────────────────────────────
# CMMS (ex: SAP PM, IBM Maximo)
CMMS_API_URL=https://cmms.company.com/api/v1
CMMS_API_KEY=<VAULT_SECRET>
CMMS_TIMEOUT=60

# ERP Integration
ERP_API_URL=https://erp.company.com/api
ERP_CLIENT_ID=<VAULT_SECRET>
ERP_CLIENT_SECRET=<VAULT_SECRET>

# ────────────────────────────────────────────────────────────────────────
# DÉVELOPPEMENT & DEBUG (DÉSACTIVÉ EN PRODUCTION)
# ────────────────────────────────────────────────────────────────────────
DEBUG=false
ENABLE_PROFILING=false
ENABLE_MOCK_DATA=false
ENABLE_HOT_RELOAD=false
ENABLE_SWAGGER_UI=false  # Désactiver en prod pour sécurité

# ════════════════════════════════════════════════════════════════════════
# CHECKLIST DE SÉCURITÉ PRODUCTION
# ════════════════════════════════════════════════════════════════════════
#
# □ Tous les <VAULT_SECRET> remplacés par vraies valeurs depuis Vault
# □ TLS/SSL activé sur tous les services
# □ Certificats SSL valides et non expirés
# □ Mots de passe forts et uniques (min 32 caractères)
# □ Clés JWT générées avec openssl rand -hex 32
# □ Firewalls configurés (uniquement ports nécessaires)
# □ Authentification activée sur tous les services
# □ Rate limiting configuré
# □ Audit logging activé
# □ Backups automatiques configurés et testés
# □ Monitoring et alerting opérationnels
# □ Plan de disaster recovery documenté et testé
# □ Accès restreints par rôles (RBAC)
# □ Logs centralisés (ELK, Splunk)
# □ Encryption at rest activée
# □ Encryption in transit activée (TLS 1.3)
# □ Secrets rotation policy en place
# □ Vulnerability scanning actif
# □ Penetration testing effectué
# □ Conformité GDPR/réglementations vérifiée
#
# ════════════════════════════════════════════════════════════════════════
