# ════════════════════════════════════════════════════════════════════════
# MANTIS - Configuration d'Environnement
# ════════════════════════════════════════════════════════════════════════
#
# Ce fichier est un TEMPLATE. NE PAS y mettre de vraies valeurs sensibles!
# Copier vers .env et remplacer les valeurs par les vraies.
#
# IMPORTANT: .env est dans .gitignore et ne doit JAMAIS être commité!
#
# ════════════════════════════════════════════════════════════════════════

# ────────────────────────────────────────────────────────────────────────
# ENVIRONNEMENT GÉNÉRAL
# ────────────────────────────────────────────────────────────────────────
ENVIRONMENT=development  # development, staging, production
PROJECT_NAME=mantis
PROJECT_VERSION=1.0.0
LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR, CRITICAL

# ────────────────────────────────────────────────────────────────────────
# KAFKA
# ────────────────────────────────────────────────────────────────────────
KAFKA_BOOTSTRAP_SERVERS=kafka:9092
KAFKA_GROUP_ID=mantis-consumer-group
KAFKA_AUTO_OFFSET_RESET=earliest

# Topics Kafka
KAFKA_TOPIC_SENSOR_RAW=sensor.raw
KAFKA_TOPIC_SENSOR_PREPROCESSED=sensor.preprocessed
KAFKA_TOPIC_FEATURES_COMPUTED=features.computed
KAFKA_TOPIC_ANOMALIES_DETECTED=anomalies.detected
KAFKA_TOPIC_RUL_PREDICTIONS=rul.predictions
KAFKA_TOPIC_MAINTENANCE_ACTIONS=maintenance.actions

# ────────────────────────────────────────────────────────────────────────
# POSTGRESQL (Métadonnées)
# ────────────────────────────────────────────────────────────────────────
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB=mantis
POSTGRES_USER=mantis
POSTGRES_PASSWORD=CHANGE_ME_IN_PRODUCTION  # ⚠️ À changer en production!
POSTGRES_MAX_CONNECTIONS=100

# ────────────────────────────────────────────────────────────────────────
# TIMESCALEDB (Séries temporelles)
# ────────────────────────────────────────────────────────────────────────
TIMESCALEDB_HOST=timescaledb
TIMESCALEDB_PORT=5432
TIMESCALEDB_DB=mantis_timeseries
TIMESCALEDB_USER=mantis
TIMESCALEDB_PASSWORD=CHANGE_ME_IN_PRODUCTION  # ⚠️ À changer en production!

# ────────────────────────────────────────────────────────────────────────
# INFLUXDB (Haute fréquence)
# ────────────────────────────────────────────────────────────────────────
INFLUXDB_URL=http://influxdb:8086
INFLUXDB_ORG=mantis
INFLUXDB_BUCKET=sensor_data
INFLUXDB_TOKEN=CHANGE_ME_IN_PRODUCTION  # ⚠️ À changer en production!
INFLUXDB_ADMIN_USER=admin
INFLUXDB_ADMIN_PASSWORD=CHANGE_ME_IN_PRODUCTION  # ⚠️ À changer en production!

# ────────────────────────────────────────────────────────────────────────
# REDIS (Cache & Feature Store)
# ────────────────────────────────────────────────────────────────────────
REDIS_HOST=redis
REDIS_PORT=6380
REDIS_PASSWORD=CHANGE_ME_IN_PRODUCTION  # ⚠️ À changer en production!
REDIS_DB=0

# ────────────────────────────────────────────────────────────────────────
# MINIO (Object Storage)
# ────────────────────────────────────────────────────────────────────────
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin  # ⚠️ À changer en production!
MINIO_SECRET_KEY=CHANGE_ME_IN_PRODUCTION  # ⚠️ À changer en production!
MINIO_SECURE=false  # true en production avec TLS
MINIO_BUCKET_RAW_DATA=raw-data
MINIO_BUCKET_PROCESSED=processed-data
MINIO_BUCKET_MODELS=models
MINIO_BUCKET_MLFLOW=mlflow

# ────────────────────────────────────────────────────────────────────────
# MLFLOW
# ────────────────────────────────────────────────────────────────────────
MLFLOW_TRACKING_URI=http://mlflow:5002
MLFLOW_BACKEND_STORE_URI=postgresql://mantis:CHANGE_ME_IN_PRODUCTION@postgres:5432/mlflow
MLFLOW_ARTIFACT_ROOT=s3://mlflow
MLFLOW_S3_ENDPOINT_URL=http://minio:9000

# ────────────────────────────────────────────────────────────────────────
# FEAST (Feature Store)
# ────────────────────────────────────────────────────────────────────────
FEAST_ONLINE_STORE=redis
FEAST_OFFLINE_STORE=parquet
FEAST_REGISTRY_PATH=s3://feast/registry.db

# ────────────────────────────────────────────────────────────────────────
# SERVICES - PORTS
# ────────────────────────────────────────────────────────────────────────
PORT_INGESTION_IIOT=8001
PORT_PREPROCESSING=8002
PORT_FEATURE_EXTRACTION=8003
PORT_ANOMALY_DETECTION=8004
PORT_RUL_PREDICTION=8005
PORT_ORCHESTRATOR=8006
PORT_DASHBOARD=3000

# ────────────────────────────────────────────────────────────────────────
# INGESTION IIOT SERVICE
# ────────────────────────────────────────────────────────────────────────
# OPC UA
OPCUA_ENDPOINT=opc.tcp://localhost:4840
OPCUA_SECURITY_POLICY=None  # None, Basic256Sha256
OPCUA_USERNAME=
OPCUA_PASSWORD=

# MQTT
MQTT_BROKER=localhost
MQTT_PORT=1883
MQTT_USERNAME=
MQTT_PASSWORD=
MQTT_CLIENT_ID=mantis-mqtt-client

# Modbus TCP
MODBUS_HOST=localhost
MODBUS_PORT=502
MODBUS_UNIT_ID=1

# ────────────────────────────────────────────────────────────────────────
# ML/AI CONFIGURATION
# ────────────────────────────────────────────────────────────────────────
# Modèles
MODEL_RUL_PATH=models/rul_model_v1
MODEL_ANOMALY_PATH=models/anomaly_detector_v1

# Hyperparamètres par défaut
RUL_WINDOW_SIZE=512
RUL_OVERLAP=0.5
ANOMALY_THRESHOLD=0.8
FEATURE_EXTRACTION_SAMPLING_RATE=1000  # Hz

# ────────────────────────────────────────────────────────────────────────
# MONITORING & OBSERVABILITY
# ────────────────────────────────────────────────────────────────────────
# Prometheus
PROMETHEUS_URL=http://prometheus:9091

# Grafana
GRAFANA_URL=http://grafana:3000
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=CHANGE_ME_IN_PRODUCTION  # ⚠️ À changer en production!

# Jaeger (Tracing)
JAEGER_AGENT_HOST=jaeger
JAEGER_AGENT_PORT=6831
JAEGER_COLLECTOR_ENDPOINT=http://jaeger:14268/api/traces

# ────────────────────────────────────────────────────────────────────────
# SÉCURITÉ
# ────────────────────────────────────────────────────────────────────────
# JWT pour authentification
JWT_SECRET_KEY=CHANGE_ME_USE_STRONG_RANDOM_KEY  # ⚠️ Générer une clé forte!
JWT_ALGORITHM=HS256
JWT_EXPIRATION_HOURS=24

# API Keys (si besoin pour intégrations externes)
EXTERNAL_API_KEY=

# ────────────────────────────────────────────────────────────────────────
# PERFORMANCE & SCALING
# ────────────────────────────────────────────────────────────────────────
# Java Services
JAVA_OPTS=-Xms512m -Xmx2g
SPRING_PROFILES_ACTIVE=development  # development, staging, production

# Python Services
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1
MAX_WORKERS=4

# ────────────────────────────────────────────────────────────────────────
# DATA PROCESSING
# ────────────────────────────────────────────────────────────────────────
# Batch sizes
KAFKA_CONSUMER_BATCH_SIZE=100
PREPROCESSING_BATCH_SIZE=256
FEATURE_EXTRACTION_BATCH_SIZE=128

# Timeouts (en secondes)
KAFKA_CONSUMER_TIMEOUT=30
HTTP_TIMEOUT=60
DB_CONNECTION_TIMEOUT=10

# ────────────────────────────────────────────────────────────────────────
# RETENTION & CLEANUP
# ────────────────────────────────────────────────────────────────────────
# TimescaleDB retention
RETENTION_RAW_DATA_DAYS=90
RETENTION_PREPROCESSED_DAYS=180
RETENTION_FEATURES_DAYS=365
RETENTION_PREDICTIONS_DAYS=365

# Compression
COMPRESSION_AFTER_DAYS=7

# ────────────────────────────────────────────────────────────────────────
# DÉVELOPPEMENT & DEBUG
# ────────────────────────────────────────────────────────────────────────
DEBUG=false  # true uniquement en développement
ENABLE_PROFILING=false
ENABLE_MOCK_DATA=false  # true pour générer des données de test

# ────────────────────────────────────────────────────────────────────────
# URLS EXTERNES (OPTIONNEL)
# ────────────────────────────────────────────────────────────────────────
# CMMS Integration (ex: SAP, Maximo)
CMMS_API_URL=
CMMS_API_KEY=

# Email Notifications
SMTP_HOST=
SMTP_PORT=587
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_FROM_EMAIL=mantis@example.com

# Slack Notifications
SLACK_WEBHOOK_URL=

# ════════════════════════════════════════════════════════════════════════
# NOTES IMPORTANTES
# ════════════════════════════════════════════════════════════════════════
#
# 1. SÉCURITÉ:
#    - NE JAMAIS commiter .env dans Git
#    - Utiliser des secrets managers en production (Vault, AWS Secrets, etc.)
#    - Changer TOUS les mots de passe par défaut
#    - Générer des clés JWT fortes (openssl rand -hex 32)
#
# 2. PRODUCTION:
#    - Activer TLS/SSL pour toutes les communications
#    - Configurer des mots de passe forts
#    - Restreindre les accès réseau
#    - Activer l'authentification sur tous les services
#
# 3. PERFORMANCE:
#    - Ajuster JAVA_OPTS selon la RAM disponible
#    - Configurer MAX_WORKERS selon les CPU disponibles
#    - Monitorer les métriques et ajuster les batch sizes
#
# ════════════════════════════════════════════════════════════════════════
